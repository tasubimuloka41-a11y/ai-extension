# Руководство по автономному выполнению задач в браузере

## Обзор

Система автономного выполнения позволяет AI модели самостоятельно выполнять задачи в браузере, используя:
- **Захват экрана** - AI видит, что происходит на странице
- **Vision анализ** - AI анализирует скриншот и определяет необходимые действия
- **Автоматическое выполнение** - AI кликает, вводит текст, скроллит и выполняет другие действия
- **Проверка результатов** - AI проверяет результат после каждого действия

## Как это работает

### Цикл выполнения задачи

1. **Захват экрана** - система делает скриншот текущей страницы
2. **Vision анализ** - AI анализирует скриншот и понимает, что видно на экране
3. **Получение информации о странице** - извлекаются все интерактивные элементы (кнопки, поля ввода, ссылки)
4. **Определение действий** - AI на основе анализа определяет последовательность действий
5. **Выполнение действий** - система выполняет действия (клики, ввод текста и т.д.)
6. **Проверка результата** - после каждого действия делается новый скриншот для проверки
7. **Повтор** - цикл повторяется до завершения задачи

## Использование

### Через интерфейс

1. Откройте расширение
2. Откройте панель агента (иконка часов)
3. В разделе "Автономное выполнение в браузере":
   - Введите описание задачи (например: "найти информацию об искусственном интеллекте")
   - Опционально укажите URL (если не указан, используется текущая вкладка)
   - Нажмите "Выполнить автономно"

### Программно

```javascript
// Добавить автономную задачу
await chrome.runtime.sendMessage({
  type: 'autonomous_browser_task',
  task: {
    description: 'Найти и заполнить форму регистрации',
    goal: 'Заполнить форму регистрации на сайте',
    url: 'https://example.com/register',
    prompt: 'Найди форму регистрации, заполни все поля и отправь форму'
  }
});
```

## Типы действий

Система поддерживает следующие типы действий:

### 1. Клик (`click`)
Клик по элементу по селектору или координатам.

```javascript
{
  type: 'click',
  target: '#submit-button'  // или { x: 100, y: 200 }
}
```

### 2. Ввод текста (`type`)
Ввод текста в поле ввода.

```javascript
{
  type: 'type',
  selector: '#email-input',
  text: 'user@example.com'
}
```

### 3. Скролл (`scroll`)
Прокрутка страницы.

```javascript
{
  type: 'scroll',
  direction: 'down',  // 'up', 'down', 'left', 'right'
  amount: 500
}
```

### 4. Ожидание (`wait`)
Пауза перед следующим действием.

```javascript
{
  type: 'wait',
  duration: 2000  // миллисекунды
}
```

## Примеры задач

### Пример 1: Поиск информации

```javascript
{
  description: 'Найти информацию об искусственном интеллекте',
  url: 'https://google.com',
  prompt: 'Введи запрос "искусственный интеллект" в поисковую строку и нажми кнопку поиска'
}
```

### Пример 2: Заполнение формы

```javascript
{
  description: 'Заполнить форму обратной связи',
  url: 'https://example.com/contact',
  prompt: 'Найди форму обратной связи, заполни все обязательные поля и отправь форму'
}
```

### Пример 3: Навигация и извлечение данных

```javascript
{
  description: 'Найти цены на товары',
  url: 'https://shop.example.com',
  prompt: 'Найди раздел с товарами, прокрути страницу и извлеки информацию о ценах'
}
```

## Требования

### Vision модель

Для работы vision анализа требуется модель, поддерживающая анализ изображений. Убедитесь, что ваша модель Gemma 3 12B поддерживает vision capabilities или используйте модель с vision поддержкой.

### Разрешения

Расширение требует следующие разрешения:
- `desktopCapture` - для захвата экрана
- `tabs` - для работы с вкладками
- `scripting` - для выполнения скриптов на страницах

## Ограничения

1. **Vision модель** - требуется модель с поддержкой анализа изображений
2. **Сложные сайты** - некоторые сайты с динамическим контентом могут быть сложными для автоматизации
3. **Авторизация** - система не может обходить капчи или сложные системы авторизации
4. **JavaScript** - сайты, требующие сложных JavaScript взаимодействий, могут быть проблематичными

## Устранение неполадок

### AI не может найти элементы

- Убедитесь, что страница полностью загружена
- Попробуйте добавить задержку перед выполнением задачи
- Проверьте, что модель поддерживает vision анализ

### Действия не выполняются

- Проверьте консоль разработчика на наличие ошибок
- Убедитесь, что у расширения есть необходимые разрешения
- Проверьте, что элементы на странице доступны (не скрыты, не в iframe)

### Скриншоты не захватываются

- Убедитесь, что вкладка активна
- Проверьте разрешение `desktopCapture` в манифесте
- Попробуйте перезагрузить расширение

## Безопасность

- Все действия выполняются только на страницах, которые вы открываете
- Система не может обходить системы безопасности браузера
- Скриншоты сохраняются только локально
- История действий доступна только вам

## Расширение функциональности

Вы можете расширить систему, добавив новые типы действий в `browser-automation.js`:

```javascript
case 'new_action':
  // Ваш код для нового действия
  break;
```

И обновив функцию `executeBrowserAction` в том же файле.

## Лучшие практики

1. **Четкие инструкции** - давайте AI четкие и конкретные описания задач
2. **Простые задачи** - начинайте с простых задач, постепенно усложняя
3. **Проверка результатов** - всегда проверяйте результаты выполнения
4. **Ограничение глубины** - не создавайте слишком длинные цепочки действий
5. **Тестирование** - тестируйте на простых сайтах перед использованием на сложных

## Примеры использования

### Автоматический поиск

```javascript
// Задача: найти информацию в поисковой системе
{
  description: 'Найти информацию о Python программировании',
  url: 'https://www.google.com',
  prompt: 'Введи "Python программирование" в поисковую строку, нажми Enter, затем проанализируй первые 5 результатов'
}
```

### Автоматическое заполнение формы

```javascript
// Задача: заполнить форму регистрации
{
  description: 'Зарегистрироваться на сайте',
  url: 'https://example.com/signup',
  prompt: 'Заполни форму: имя "Иван", email "ivan@example.com", пароль "SecurePass123", затем нажми кнопку регистрации'
}
```

### Извлечение данных

```javascript
// Задача: собрать данные со страницы
{
  description: 'Собрать список товаров и цен',
  url: 'https://shop.example.com/products',
  prompt: 'Прокрути страницу, найди все товары с ценами и извлеки эту информацию'
}
```

## Технические детали

### Формат запроса к Vision модели

```json
{
  "model": "gemma-3-12b",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "Опиши, что видно на экране"
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "data:image/png;base64,..."
          }
        }
      ]
    }
  ]
}
```

### Генерация селекторов

Система автоматически генерирует CSS селекторы для элементов:
1. По ID: `#element-id`
2. По классу: `.class-name`
3. По тегу и классу: `tag.class-name`
4. По XPath (fallback): `tag > parent > element`

### Сохранение скриншотов

Скриншоты сохраняются в истории агента и могут быть использованы для:
- Отладки выполнения задач
- Анализа результатов
- Восстановления состояния

